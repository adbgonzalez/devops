# Docker Compose: IntroduciÃ³n e uso bÃ¡sico

## 1. Que Ã© Docker Compose

**Docker Compose** Ã© unha ferramenta que permite **definir e executar aplicaciÃ³ns multi-contedor** mediante un Ãºnico ficheiro de configuraciÃ³n YAML (`docker-compose.yml`).

En lugar de executar varios comandos `docker run` manualmente, con Compose podes **declarar servizos, redes e volumes** nun sÃ³ ficheiro e levantar todo o entorno con:

```bash
docker compose up
```

---

## 2. Para que serve

- **Organizar contedores relacionados** (por exemplo, unha app web + base de datos).  
- **Automatizar despregues locais** e reproducibles.  
- **Definir configuraciÃ³ns complexas** (portos, variables de entorno, volumes, etc.) nun sÃ³ documento.  
- **Evitar erros humanos** e facilitar colaboraciÃ³n entre desenvolvedores.  

---

## 3. Sintaxe bÃ¡sica do ficheiro `docker-compose.yml`

Estrutura xeral:

```yaml
version: "3.9"        # VersiÃ³n da sintaxe de Docker Compose
services:             # Lista de servizos (cada un Ã© un contedor)
  nome_servizo:
    image: imaxe:etiqueta
    container_name: nome_contedor
    ports:
      - "host:contedor"
    environment:
      - VARIABLE1=valor1
    volumes:
      - ./ruta_local:/ruta_contedor
    depends_on:
      - outro_servizo
volumes:              # (opcional) DefiniciÃ³n de volumes persistentes
networks:             # (opcional) DefiniciÃ³n de redes personalizadas
```

**Elementos principais:**

| Clave | ExplicaciÃ³n |
|--------|-------------|
| `version` | Define a versiÃ³n da especificaciÃ³n de Docker Compose. |
| `services` | Cada servizo representa un contedor. |
| `image` | Indica a imaxe que se vai usar. |
| `build` | Permite construÃ­r unha imaxe a partir dun Dockerfile local. |
| `ports` | Mapea portos do host co contedor. |
| `environment` | Engade variables de entorno ao contedor. |
| `volumes` | Define volumes compartidos (para persistencia ou cÃ³digo). |
| `depends_on` | Indica dependencias entre servizos (ordena o arranque). |

---

## 4. Exemplo 1: Servidor web simple con Nginx

### Estrutura de directorios

```
/compose-web
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ index.html
```

### index.html

```html
<!DOCTYPE html>
<html>
<head><title>Docker Compose</title></head>
<body><h1>Benvido ao servidor Nginx con Docker Compose!</h1></body>
</html>
```

### docker-compose.yml

```yaml
version: "3.9"
services:
  web:
    image: nginx:alpine
    container_name: web_nginx
    ports:
      - "8080:80"
    volumes:
      - ./index.html:/usr/share/nginx/html/index.html
```

### ExecuciÃ³n

```bash
docker compose up -d
```

Abre o navegador e visita:  
ðŸ‘‰ [http://localhost:8080](http://localhost:8080)

Para deter e eliminar os contedores:
```bash
docker compose down
```

---

## 5. Exemplo 2: AplicaciÃ³n web con Python e base de datos MySQL

Este exemplo amosa como **varios servizos poden traballar xuntos**.

### Estrutura do proxecto

```
/compose-flask-mysql
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ Dockerfile
â””â”€â”€ docker-compose.yml
```

### app/app.py

```python
from flask import Flask
import os, mysql.connector

app = Flask(__name__)

@app.route('/')
def index():
    db = mysql.connector.connect(
        host="db",
        user="root",
        password=os.environ.get("MYSQL_ROOT_PASSWORD"),
        database="demo"
    )
    cursor = db.cursor()
    cursor.execute("SELECT 'Docker Compose funcionando!'")
    return cursor.fetchone()[0]

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)
```

### app/requirements.txt

```
Flask==3.0.0
mysql-connector-python==9.1.0
```

### app/Dockerfile

```Dockerfile
FROM python:3.12-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
CMD ["python", "app.py"]
```

### docker-compose.yml

```yaml
version: "3.9"
services:
  web:
    build: ./app
    container_name: flask_app
    ports:
      - "5000:5000"
    environment:
      - MYSQL_ROOT_PASSWORD=1234
    depends_on:
      - db

  db:
    image: mysql:8.0
    container_name: mysql_db
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      MYSQL_DATABASE: demo
    volumes:
      - db_data:/var/lib/mysql

volumes:
  db_data:
```

### ExecuciÃ³n

```bash
docker compose up -d
```

Logo, accede en:  
ðŸ‘‰ [http://localhost:5000](http://localhost:5000)

VerÃ¡s a mensaxe:  
`Docker Compose funcionando!`

Para deter e limpar todo:

```bash
docker compose down -v
```

---

## 6. Resumo de comandos principais

| Comando | FunciÃ³n |
|----------|----------|
| `docker compose up` | Inicia todos os servizos definidos. |
| `docker compose up -d` | Inicia en segundo plano (detached). |
| `docker compose down` | DetÃ©n e elimina contedores e redes. |
| `docker compose ps` | Lista os servizos activos. |
| `docker compose logs -f` | Mostra os logs en tempo real. |
| `docker compose build` | ConstrÃºe imaxes definidas con `build`. |
| `docker compose exec <servizo> bash` | Abre unha shell dentro dun servizo. |

---

## 7. Boas prÃ¡cticas

- Empregar versiÃ³ns **estables e concretas** das imaxes (`nginx:alpine`, `mysql:8.0`, etc.).  
- Non gardar contrasinais no ficheiro, usar `.env` se Ã© necesario.  
- Definir volumes para **persistir datos** de bases de datos.  
- Engadir `depends_on` para ordenar a execuciÃ³n dos servizos.  
- Empregar `docker compose down -v` para limpar volumes e redes cando fagas probas.
